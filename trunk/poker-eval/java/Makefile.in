RM = @RM@
JAVA = @JAVA@
JAVAC = @JAVAC@
JAVAH = @JAVAH@
JDKHOME	= $(dir $(JAVAH))/..
SLIB_CMD = @SLIB_CMD@

JAVADOCDIR	:= javadoc
SRC_JAVA 	:= $(shell find . -name '*.java')
ALL_PKGS        := $(sort $(dir $(SRC_JAVA)))
ALL_PKGS        := $(patsubst %/,%, $(ALL_PKGS))
ALL_PKGS        := $(subst /,., $(ALL_PKGS))
CLASSFILES	:= $(SRC_JAVA:.java=.class)

JNI_JAVA	:= org/pokersource/eval/StandardEval.java \
		   org/pokersource/eval/JokerEval.java \
		   org/pokersource/eval/AsianStudEval.java
JNI_CLASSES	:= $(subst /,., $(JNI_JAVA:.java=))
JNI_CLASSFILES	:= $(JNI_JAVA:.java=.class)
JNI_OBJS	:= $(JNI_JAVA:.java=Imp.o)
JNI_OBJS	+= jniutil.o
JNI_HEADER	:= pokerjni.h
JNILIB		:= libpokerjni@SO@
JNI_INCLUDES	:= $(addprefix -I, $(shell find $(JDKHOME)/include -type d))

all: classes jnilib
classes: $(CLASSFILES)
jnilib: $(JNILIB)

javadoc:
	@$(MKDIRHIER) $(JAVADOCDIR)
	$(JAVADOC) -d $(JAVADOCDIR) -classpath $(CLASSPATH) $(ALL_PKGS)

clean: cleanclass
	$(RM) $(JNI_HEADER) $(JNI_OBJS) $(JNILIB)
cleanclass:
	$(RM) $(CLASSFILES)

%.class: %.java
	$(JAVAC) -classpath $(CLASSPATH) $<

pokerjni.h: $(JNI_CLASSFILES)
	$(JAVAH) -o $@ -jni -force $(JNI_CLASSES)

.c@O@:
	$(CC) $(CFLAGS) -I. -I../include $(JNI_INCLUDES) -c $< -o $@

# must fix hardcoding:
$(JNILIB): $(JNI_OBJS)
	$(SLIB_CMD) -L../lib -lpoker

$(JNI_OBJS): $(JNI_HEADER)

Makefile: Makefile.in
