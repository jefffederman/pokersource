#!/usr/bin/make -f
# -*- makefile -*-

include /usr/share/cdbs/1/rules/debhelper.mk

#
# This triggers an extra configure but is needed when building from
# the CVS because the CVS contains an old configure that should not
# be removed for now. Should the configure be removed, uncomment the
# lines after the include and remove the rm from this target to avoid
# the extra configure.
#
clean:: $(DEB_BUILDDIR)/config.status
	rm -f $(DEB_SRCDIR)/configure $(DEB_SRCDIR)/*cdbs-*

include /usr/share/cdbs/1/class/autotools.mk

# see the comment above
#clean::
#	rm -f $(DEB_SRCDIR)/configure $(DEB_SRCDIR)/*cdbs-*

ifneq (ccache,$(findstring ccache,$(DEB_BUILD_OPTIONS)))
        DEB_CONFIGURE_EXTRA_FLAGS += --without-ccache
endif

DEB_MAKE_CLEAN_TARGET = maintainer-clean

is_debug_package=$(if $(findstring noopt,$(DEB_BUILD_OPTIONS)),yes,)

$(DEB_SRCDIR)/configure:: $(CURDIR)/$(DEB_SRCDIR)/bootstrap
	sh bootstrap
	chmod a+x $@

# override in order to add dependency to configure (should be a :: rule instead of a : rule)
$(DEB_BUILDDIR)/config.status: $(DEB_SRCDIR)/configure
	chmod a+x $(DEB_CONFIGURE_SCRIPT)
	$(DEB_CONFIGURE_INVOKE) $(cdbs_configure_flags) $(DEB_CONFIGURE_EXTRA_FLAGS) $(DEB_CONFIGURE_USER_FLAGS)

