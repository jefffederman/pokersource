LIB=libpoker.a

MKTABLE_HELPERS = mktable.o mktable_utils.o

OBJ=$(DERIVED_SOURCES:.c=.o) \
	mktab_basic.o $(MKTABLE_HELPERS) \
	stddeck.o stdrules.o \
	md5c.o

BASIC_TABLES = \
	t_nbits.c t_topbit.c t_topcard.c t_topfivecards.c t_topfivebits.c \
        t_toptwobits.c t_cardmasks.c t_maskrank.c t_straight.c 
PACKED_TABLES = \
	t_nbitsandstr.c
EVX_TABLES = \
	t_evx_pairval.c t_evx_strval.c t_evx_tripsval.c t_evx_flushcards.c

EVX_HEADERS = ../include/inlines/evx5.h ../include/inlines/evx7.h

PROGRAMS = mktab_basic mktab_packed mktab_evx evx_gen5 evx_gen7

DERIVED_SOURCES = $(BASIC_TABLES) $(PACKED_TABLES) $(EVX_TABLES)

CC = @CC@ 
CFLAGS = @CFLAGS@ 
RANLIB = @RANLIB@ 
AR=ar

all:	$(LIB) $(EVX_HEADERS)

$(LIB): $(OBJ)
	$(AR) cr $(LIB) $(OBJ)
	$(RANLIB) $(LIB)

clean:
	rm -f $(OBJ) $(LIB) $(DERIVED_SOURCES) $(PROGRAMS)

$(BASIC_TABLES): mktab_basic
	./$<

$(PACKED_TABLES): mktab_packed
	./$<

$(EVX_TABLES): mktab_evx
	./$<

../include/inlines/evx5.h:	evx_gen5
	./$<  >  $@

../include/inlines/evx7.h:	evx_gen7
	./$<  >  $@


mktab_basic: mktab_basic.o $(MKTABLE_HELPERS)
	$(CC) $(CFLAGS) -I../include -o $@ $< $(MKTABLE_HELPERS)

mktab_packed: mktab_packed.o $(MKTABLE_HELPERS)
	$(CC) $(CFLAGS) -I../include -o $@ $< $(MKTABLE_HELPERS)

mktab_evx: mktab_evx.o $(MKTABLE_HELPERS)
	$(CC) $(CFLAGS) -I../include -o $@ $< $(MKTABLE_HELPERS)

evx_gen5:	evx_gen5.o
	$(CC) -o $@ $<

evx_gen7:	evx_gen7.o
	$(CC) -o $@ $<

.c.o:
	$(CC) $(CFLAGS) -I../include -c $<

evx_gen5.o:	evx_generate.c
	$(CC) $(CFLAGS) -I../include -DCARDS_DEALT=5 -c $< -o $@

evx_gen7.o:	evx_generate.c
	$(CC) $(CFLAGS) -I../include -DCARDS_DEALT=7 -c $< -o $@

